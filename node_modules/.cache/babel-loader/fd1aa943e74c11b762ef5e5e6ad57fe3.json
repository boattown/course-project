{"ast":null,"code":"import { send } from \"xstate\";\nimport { nluRequest } from \"./index\";\n\nfunction say(text) {\n  return send(function (_context) {\n    return {\n      type: \"SPEAK\",\n      value: text\n    };\n  });\n}\n\nfunction listen() {\n  return send('LISTEN');\n}\n\nfunction rasaParse(target1, intent1, target2, intent2) {\n  return {\n    invoke: {\n      id: 'rasa',\n      src: function src(context, event) {\n        return nluRequest(context.recResult);\n      },\n      onDone: [{\n        target: \"#root.dm.game.\".concat(target1),\n        cond: function cond(context, event) {\n          return event.data.intent[\"name\"] === intent1;\n        }\n      }, {\n        target: \"#root.dm.game.\".concat(target2),\n        cond: function cond(context, event) {\n          return event.data.intent[\"name\"] === intent2;\n        }\n      }, {\n        target: \"#root.dm.game.help\",\n        cond: function cond(context, event) {\n          return event.data.intent[\"name\"] === \"help\";\n        }\n      }, {\n        target: \"#root.dm.game.help\",\n        cond: function cond(context, event) {\n          return event.data.intent[\"name\"] === \"quit\";\n        }\n      }]\n    }\n  };\n}\n\nexport var dmMachine = {\n  initial: 'init',\n  states: {\n    init: {\n      on: {\n        CLICK: 'welcome'\n      }\n    },\n    welcome: {\n      initial: \"prompt\",\n      on: {\n        RECOGNISED: {\n          target: \"invoking_rasa\"\n        }\n      },\n      states: {\n        prompt: {\n          entry: say(\"Welcome to MLT Maze Game! This is a dialogue-based game where you will try to reach your goal by choosing the best route. When you’re ready, say: Play.\"),\n          on: {\n            ENDSPEECH: \"ask\"\n          }\n        },\n        ask: {\n          entry: listen()\n        }\n      }\n    },\n    invoking_rasa: {\n      invoke: {\n        id: 'rasa',\n        src: function src(context, event) {\n          return nluRequest(context.recResult);\n        },\n        onDone: [{\n          target: \"game\",\n          cond: function cond(context, event) {\n            return event.data.intent[\"name\"] === \"play\";\n          }\n        }, {\n          target: \"help\",\n          cond: function cond(context, event) {\n            return event.data.intent[\"name\"] === \"help\";\n          }\n        }, {\n          target: \"quit\",\n          cond: function cond(context, event) {\n            return event.data.intent[\"name\"] === \"quit\";\n          }\n        }],\n        onError: {\n          target: 'help'\n        }\n      }\n    },\n    game: {\n      initial: \"start\",\n      states: {\n        start: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"humanisten\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"Ok, let’s play! It’s a beautiful day in spring. You are an MLT student and have just finished an exam at Humanisten. You were the last one to turn in the exam and your classmates are already celebrating in a bar on Andra Långgatan. You need to get there before they finish their drinks and go home. But since you are new in the city, you are not sure of the way\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        humanisten: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \".rasa\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"On your way out of Humanisten, you recieve a text message from a classmate. She says you need to get to Järntorget and that the trams 6 and 3 go there. The nearest tram stops you know of are Götaplatsen and Coshvergen. Which one do you go to?\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            },\n            rasa: rasaParse('gotaplatsen', 'götaplatsen', 'korsvagen', 'korsvägen')\n          }\n        },\n        gotaplatsen: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"valand\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You head towards Götaplatsen and the sight of Poseidon with Avenyn in the background simply takes your breath away. It’s beautiful and you feel good! But when you reach the public transport stop you realize there are no trams there, only busses. A nice lady informs you that the tram stop Valand is further down the street. Do you continue towards Valand or do you jump on a bus?\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        korsvagen: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"brunnsparken\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You start walking down the steep stairs towards Korsvägen which looks more like a construction site than a tram stop. You look around and try to orientate yourself when you suddenly see tram number 6. The doors are about to close but you can make it if you hurry! Do you run to catch it?\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        brunnsparken: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"hjalmarbranting\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"Since you don’t feel like running in public, you stand still and watch tram 6 depart. Instead, you take tram 4 to Brunnsparken and decide to change to another tram line there. When you reach Brunnsparken, you get off the tram and look around. You see that both number 6 and 1 depart from here, and they should both take you to Järntorget. Which one do you take?\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        valand: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"vasaplatsen\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You continue to walk down Avenyn and you’re in a great mood. The exam went amazingly well and soon you will be celebrating with your classmates. You reach the tram stop at Valand that the nice lady told you about and look at the monitor. But what? Due to a technical error, there is currently no tram traffic between Valand and Järntorget. Your options now are to continue to walk towards Järntorget or to take a tram down to Brunnsparken.\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        vasaplatsen: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"jarntorget\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You start to walk along Vasagatan. It’s a beautiful walk with elmtrees on both sides. You reach the tram stop at Vasaplatsen and check the monitor. But no, there are still no trams passing. You start to feel tired from all the walking and see a station of the public city bikes. You’re tempted to try one, since it would probably get you to Järntorget faster. Do you take a bike or do you continue to walk?\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        jarntorget: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"andralang\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"After a long walk you finally reach Järntorget and there it is: Andra långgatan! Just a few meter left to walk…\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        andralang: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"win\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"While you’re walking along the bar street you see how the sky turns pink. You take a deep breath of the spring air and think to yourself how much you love this city. Suddenly, you see a group of people smiling and waving to you from inside one of the bars. It’s your classmates! You made it!\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        kortedala: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"win\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You hurry towards the tram and manage to get inside, just as the doors close behind you. Relieved, you find a seat and text your classmate that you are on your way. The exam is over and you feel great!  You wait for the name ”Järntorget” to show up on the monitor. When you pass Redbergsplatsen you get a bad feeling and ask the man next to you if tram number 6 really goes to Järntorget. He says it does, but in the opposite direction! You are now halfway to Kortedala and realize you will never make it to the bar in time.\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        hjalmarbranting: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"win\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You board tram number 6, confident that it will take you to Järntorget. After just one stop, you find yourself on a bridge! The view of the city and Göta River is wonderful, but this can’t be right… You ask the woman next to you if tram number 6 really goes to Järntorget. She says it does, but that you have taken it in the wrong direction! You are now on Hisingen island and there is no way you will make it to the bar in time.\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        styrostall: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"gameover\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"You approach the bike terminal and read the instructions in English. Apparently you need to download an app and register with your credit card. When you finally manage to register and get a bike, you start to regret your desicion since you didn’t really have time for this. You start to pedal as fast as you can along the tram tracks towards Järntorget when you’re suddenly thrown off the bike. The front weel got stuck in one of the tram tracks. You have a terrible pain in your arm and need to go the hospital. Your classmates will have to celebrate without you…\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        win: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"#root.dm\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"Congratulations! You won! Your strategy for reaching the bar awards you with a gold medal. Come back anytime if you want to play again.\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        },\n        gameover: {\n          initial: \"prompt\",\n          on: {\n            RECOGNISED: {\n              target: \"#root.dm\"\n            }\n          },\n          states: {\n            prompt: {\n              entry: say(\"Oh no! You lost! You didn't make it to the bar in time. Click on the screen if you want to try again.\"),\n              on: {\n                ENDSPEECH: \"ask\"\n              }\n            },\n            ask: {\n              entry: listen()\n            }\n          }\n        }\n      }\n    },\n    help: {\n      initial: \"prompt\",\n      states: {\n        prompt: {\n          entry: say(\"Help message.\"),\n          on: {\n            ENDSPEECH: \"#root.dm\"\n          }\n        }\n      }\n    },\n    quit: {\n      initial: \"prompt\",\n      states: {\n        prompt: {\n          entry: say(\"Ok. You have quit the game.\"),\n          on: {\n            ENDSPEECH: \"#root.dm\"\n          }\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/mnt/c/Users/batst/LWshare/dialogue-systems-2021/course-project-klara-bastedt/src/dmGame.ts"],"names":["send","nluRequest","say","text","_context","type","value","listen","rasaParse","target1","intent1","target2","intent2","invoke","id","src","context","event","recResult","onDone","target","cond","data","intent","dmMachine","initial","states","init","on","CLICK","welcome","RECOGNISED","prompt","entry","ENDSPEECH","ask","invoking_rasa","onError","game","start","humanisten","rasa","gotaplatsen","korsvagen","brunnsparken","valand","vasaplatsen","jarntorget","andralang","kortedala","hjalmarbranting","styrostall","win","gameover","help","quit"],"mappings":"AAAA,SAAwBA,IAAxB,QAA4C,QAA5C;AACA,SAASC,UAAT,QAA2B,SAA3B;;AAEA,SAASC,GAAT,CAAaC,IAAb,EAAyD;AACrD,SAAOH,IAAI,CAAC,UAACI,QAAD;AAAA,WAA2B;AAAEC,MAAAA,IAAI,EAAE,OAAR;AAAiBC,MAAAA,KAAK,EAAEH;AAAxB,KAA3B;AAAA,GAAD,CAAX;AACH;;AAED,SAASI,MAAT,GAAgD;AAC5C,SAAOP,IAAI,CAAC,QAAD,CAAX;AACH;;AAED,SAASQ,SAAT,CAAmBC,OAAnB,EAAoCC,OAApC,EAAqDC,OAArD,EAAsEC,OAAtE,EAAiI;AAC7H,SAAQ;AACJC,IAAAA,MAAM,EAAE;AACJC,MAAAA,EAAE,EAAE,MADA;AAEJC,MAAAA,GAAG,EAAE,aAACC,OAAD,EAAUC,KAAV;AAAA,eAAoBhB,UAAU,CAACe,OAAO,CAACE,SAAT,CAA9B;AAAA,OAFD;AAGJC,MAAAA,MAAM,EAAE,CACJ;AAAEC,QAAAA,MAAM,0BAAmBX,OAAnB,CAAR;AAAsCY,QAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,iBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8Bb,OAAlD;AAAA;AAA5C,OADI,EAEJ;AAAEU,QAAAA,MAAM,0BAAmBT,OAAnB,CAAR;AAAsCU,QAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,iBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8BX,OAAlD;AAAA;AAA5C,OAFI,EAGJ;AAAEQ,QAAAA,MAAM,EAAE,oBAAV;AAAgCC,QAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,iBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8B,MAAlD;AAAA;AAAtC,OAHI,EAIJ;AAAEH,QAAAA,MAAM,EAAE,oBAAV;AAAgCC,QAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,iBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8B,MAAlD;AAAA;AAAtC,OAJI;AAHJ;AADJ,GAAR;AAaH;;AAED,OAAO,IAAMC,SAAmD,GAAI;AAChEC,EAAAA,OAAO,EAAE,MADuD;AAEhEC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAE;AACFC,MAAAA,EAAE,EAAE;AACAC,QAAAA,KAAK,EAAE;AADP;AADF,KADF;AAMJC,IAAAA,OAAO,EAAE;AACLL,MAAAA,OAAO,EAAE,QADJ;AAELG,MAAAA,EAAE,EAAE;AACAG,QAAAA,UAAU,EAAE;AACRX,UAAAA,MAAM,EAAE;AADA;AADZ,OAFC;AAOLM,MAAAA,MAAM,EAAE;AACJM,QAAAA,MAAM,EAAE;AACJC,UAAAA,KAAK,EAAE/B,GAAG,CAAC,yJAAD,CADN;AAEJ0B,UAAAA,EAAE,EAAE;AAAEM,YAAAA,SAAS,EAAE;AAAb;AAFA,SADJ;AAKJC,QAAAA,GAAG,EAAE;AACDF,UAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPH,KANL;AAuBJ6B,IAAAA,aAAa,EAAE;AACXvB,MAAAA,MAAM,EAAE;AACJC,QAAAA,EAAE,EAAE,MADA;AAEJC,QAAAA,GAAG,EAAE,aAACC,OAAD,EAAUC,KAAV;AAAA,iBAAoBhB,UAAU,CAACe,OAAO,CAACE,SAAT,CAA9B;AAAA,SAFD;AAGJC,QAAAA,MAAM,EAAE,CACJ;AAAEC,UAAAA,MAAM,EAAE,MAAV;AAAkBC,UAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,mBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8B,MAAlD;AAAA;AAAxB,SADI,EAEJ;AAAEH,UAAAA,MAAM,EAAE,MAAV;AAAkBC,UAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,mBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8B,MAAlD;AAAA;AAAxB,SAFI,EAGJ;AAAEH,UAAAA,MAAM,EAAE,MAAV;AAAkBC,UAAAA,IAAI,EAAE,cAACL,OAAD,EAAUC,KAAV;AAAA,mBAAoBA,KAAK,CAACK,IAAN,CAAWC,MAAX,CAAkB,MAAlB,MAA8B,MAAlD;AAAA;AAAxB,SAHI,CAHJ;AAOJc,QAAAA,OAAO,EAAE;AACLjB,UAAAA,MAAM,EAAE;AADH;AAPL;AADG,KAvBX;AAoCJkB,IAAAA,IAAI,EAAE;AACFb,MAAAA,OAAO,EAAE,OADP;AAEFC,MAAAA,MAAM,EAAE;AACJa,QAAAA,KAAK,EAAE;AACHd,UAAAA,OAAO,EAAE,QADN;AAEHG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFD;AAOHM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,2WAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPL,SADH;AAkBJiC,QAAAA,UAAU,EAAE;AACRf,UAAAA,OAAO,EAAE,QADD;AAERG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFI;AAORM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,oPAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ,aALD;AAQJkC,YAAAA,IAAI,EAAEjC,SAAS,CAAC,aAAD,EAAgB,aAAhB,EAA+B,WAA/B,EAA4C,WAA5C;AARX;AAPA,SAlBR;AAoCJkC,QAAAA,WAAW,EAAE;AACTjB,UAAAA,OAAO,EAAE,QADA;AAETG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFK;AAOTM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,6XAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPC,SApCT;AAqDJoC,QAAAA,SAAS,EAAE;AACPlB,UAAAA,OAAO,EAAE,QADF;AAEPG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFG;AAOPM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,iSAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPD,SArDP;AAsEJqC,QAAAA,YAAY,EAAE;AACVnB,UAAAA,OAAO,EAAE,QADC;AAEVG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFM;AAOVM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,2WAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPE,SAtEV;AAuFJsC,QAAAA,MAAM,EAAE;AACJpB,UAAAA,OAAO,EAAE,QADL;AAEJG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFA;AAOJM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,ybAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPJ,SAvFJ;AAwGJuC,QAAAA,WAAW,EAAE;AACTrB,UAAAA,OAAO,EAAE,QADA;AAETG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFK;AAOTM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,wZAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPC,SAxGT;AAyHJwC,QAAAA,UAAU,EAAE;AACRtB,UAAAA,OAAO,EAAE,QADD;AAERG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFI;AAORM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,iHAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPA,SAzHR;AA0IJyC,QAAAA,SAAS,EAAE;AACPvB,UAAAA,OAAO,EAAE,QADF;AAEPG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFG;AAOPM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,qSAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPD,SA1IP;AA2JJ0C,QAAAA,SAAS,EAAE;AACPxB,UAAAA,OAAO,EAAE,QADF;AAEPG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFG;AAOPM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,8gBAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPD,SA3JP;AA4KJ2C,QAAAA,eAAe,EAAE;AACbzB,UAAAA,OAAO,EAAE,QADI;AAEbG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFS;AAObM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,+aAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPK,SA5Kb;AA6LJ4C,QAAAA,UAAU,EAAE;AACR1B,UAAAA,OAAO,EAAE,QADD;AAERG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFI;AAORM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,sjBAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPA,SA7LR;AA8MJ6C,QAAAA,GAAG,EAAE;AACD3B,UAAAA,OAAO,EAAE,QADR;AAEDG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFH;AAODM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,yIAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPP,SA9MD;AA+NJ8C,QAAAA,QAAQ,EAAE;AACN5B,UAAAA,OAAO,EAAE,QADH;AAENG,UAAAA,EAAE,EAAE;AACAG,YAAAA,UAAU,EAAE;AACRX,cAAAA,MAAM,EAAE;AADA;AADZ,WAFE;AAONM,UAAAA,MAAM,EAAE;AACJM,YAAAA,MAAM,EAAE;AACJC,cAAAA,KAAK,EAAE/B,GAAG,CAAC,uGAAD,CADN;AAEJ0B,cAAAA,EAAE,EAAE;AAAEM,gBAAAA,SAAS,EAAE;AAAb;AAFA,aADJ;AAKJC,YAAAA,GAAG,EAAE;AACDF,cAAAA,KAAK,EAAE1B,MAAM;AADZ;AALD;AAPF;AA/NN;AAFN,KApCF;AAwRJ+C,IAAAA,IAAI,EAAE;AACF7B,MAAAA,OAAO,EAAE,QADP;AAEFC,MAAAA,MAAM,EAAE;AACJM,QAAAA,MAAM,EAAE;AACJC,UAAAA,KAAK,EAAE/B,GAAG,CAAC,eAAD,CADN;AAEJ0B,UAAAA,EAAE,EAAE;AAAEM,YAAAA,SAAS,EAAE;AAAb;AAFA;AADJ;AAFN,KAxRF;AAiSJqB,IAAAA,IAAI,EAAE;AACF9B,MAAAA,OAAO,EAAE,QADP;AAEFC,MAAAA,MAAM,EAAE;AACJM,QAAAA,MAAM,EAAE;AACJC,UAAAA,KAAK,EAAE/B,GAAG,CAAC,6BAAD,CADN;AAEJ0B,UAAAA,EAAE,EAAE;AAAEM,YAAAA,SAAS,EAAE;AAAb;AAFA;AADJ;AAFN;AAjSF;AAFwD,CAA7D","sourcesContent":["import { MachineConfig, send, Action } from \"xstate\";\nimport { nluRequest } from \"./index\"\n\nfunction say(text: string): Action<SDSContext, SDSEvent> {\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\n}\n\nfunction listen(): Action<SDSContext, SDSEvent> {\n    return send('LISTEN')\n}\n\nfunction rasaParse(target1: string, intent1: string, target2: string, intent2: string): MachineConfig<SDSContext, any, SDSEvent> {\n    return ({\n        invoke: {\n            id: 'rasa',\n            src: (context, event) => nluRequest(context.recResult),\n            onDone: [\n                { target: `#root.dm.game.${target1}`, cond: (context, event) => event.data.intent[\"name\"] === intent1 },\n                { target: `#root.dm.game.${target2}`, cond: (context, event) => event.data.intent[\"name\"] === intent2 },                    \n                { target: \"#root.dm.game.help\", cond: (context, event) => event.data.intent[\"name\"] === \"help\" },\n                { target: \"#root.dm.game.help\", cond: (context, event) => event.data.intent[\"name\"] === \"quit\" }],\n        }\n\n\n    })\n}\n\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\n    initial: 'init',\n    states: {\n        init: {\n            on: {\n                CLICK: 'welcome'\n            }\n        },\n        welcome: {\n            initial: \"prompt\",\n            on: {\n                RECOGNISED: {\n                    target: \"invoking_rasa\",\n                }\n            },\n            states: {\n                prompt: {\n                    entry: say(\"Welcome to MLT Maze Game! This is a dialogue-based game where you will try to reach your goal by choosing the best route. When you’re ready, say: Play.\"),\n                    on: { ENDSPEECH: \"ask\" }\n                },\n                ask: {\n                    entry: listen()\n                }\n            }\n        },\n        invoking_rasa: {\n            invoke: {\n                id: 'rasa',\n                src: (context, event) => nluRequest(context.recResult),\n                onDone: [\n                    { target: \"game\", cond: (context, event) => event.data.intent[\"name\"] === \"play\" },\n                    { target: \"help\", cond: (context, event) => event.data.intent[\"name\"] === \"help\" },\n                    { target: \"quit\", cond: (context, event) => event.data.intent[\"name\"] === \"quit\" }],\n                onError: {\n                    target: 'help',\n                }\n            }\n        },\n        game: {\n            initial: \"start\",\n            states: {\n                start: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"humanisten\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"Ok, let’s play! It’s a beautiful day in spring. You are an MLT student and have just finished an exam at Humanisten. You were the last one to turn in the exam and your classmates are already celebrating in a bar on Andra Långgatan. You need to get there before they finish their drinks and go home. But since you are new in the city, you are not sure of the way\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                humanisten: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \".rasa\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"On your way out of Humanisten, you recieve a text message from a classmate. She says you need to get to Järntorget and that the trams 6 and 3 go there. The nearest tram stops you know of are Götaplatsen and Coshvergen. Which one do you go to?\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        },\n                        rasa: rasaParse('gotaplatsen', 'götaplatsen', 'korsvagen', 'korsvägen'),\n                    }\n                },\n                gotaplatsen: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"valand\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You head towards Götaplatsen and the sight of Poseidon with Avenyn in the background simply takes your breath away. It’s beautiful and you feel good! But when you reach the public transport stop you realize there are no trams there, only busses. A nice lady informs you that the tram stop Valand is further down the street. Do you continue towards Valand or do you jump on a bus?\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                korsvagen: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"brunnsparken\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You start walking down the steep stairs towards Korsvägen which looks more like a construction site than a tram stop. You look around and try to orientate yourself when you suddenly see tram number 6. The doors are about to close but you can make it if you hurry! Do you run to catch it?\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                brunnsparken: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"hjalmarbranting\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"Since you don’t feel like running in public, you stand still and watch tram 6 depart. Instead, you take tram 4 to Brunnsparken and decide to change to another tram line there. When you reach Brunnsparken, you get off the tram and look around. You see that both number 6 and 1 depart from here, and they should both take you to Järntorget. Which one do you take?\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                valand: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"vasaplatsen\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You continue to walk down Avenyn and you’re in a great mood. The exam went amazingly well and soon you will be celebrating with your classmates. You reach the tram stop at Valand that the nice lady told you about and look at the monitor. But what? Due to a technical error, there is currently no tram traffic between Valand and Järntorget. Your options now are to continue to walk towards Järntorget or to take a tram down to Brunnsparken.\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                vasaplatsen: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"jarntorget\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You start to walk along Vasagatan. It’s a beautiful walk with elmtrees on both sides. You reach the tram stop at Vasaplatsen and check the monitor. But no, there are still no trams passing. You start to feel tired from all the walking and see a station of the public city bikes. You’re tempted to try one, since it would probably get you to Järntorget faster. Do you take a bike or do you continue to walk?\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                jarntorget: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"andralang\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"After a long walk you finally reach Järntorget and there it is: Andra långgatan! Just a few meter left to walk…\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                andralang: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"win\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"While you’re walking along the bar street you see how the sky turns pink. You take a deep breath of the spring air and think to yourself how much you love this city. Suddenly, you see a group of people smiling and waving to you from inside one of the bars. It’s your classmates! You made it!\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                kortedala: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"win\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You hurry towards the tram and manage to get inside, just as the doors close behind you. Relieved, you find a seat and text your classmate that you are on your way. The exam is over and you feel great!  You wait for the name ”Järntorget” to show up on the monitor. When you pass Redbergsplatsen you get a bad feeling and ask the man next to you if tram number 6 really goes to Järntorget. He says it does, but in the opposite direction! You are now halfway to Kortedala and realize you will never make it to the bar in time.\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                hjalmarbranting: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"win\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You board tram number 6, confident that it will take you to Järntorget. After just one stop, you find yourself on a bridge! The view of the city and Göta River is wonderful, but this can’t be right… You ask the woman next to you if tram number 6 really goes to Järntorget. She says it does, but that you have taken it in the wrong direction! You are now on Hisingen island and there is no way you will make it to the bar in time.\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                styrostall: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"gameover\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"You approach the bike terminal and read the instructions in English. Apparently you need to download an app and register with your credit card. When you finally manage to register and get a bike, you start to regret your desicion since you didn’t really have time for this. You start to pedal as fast as you can along the tram tracks towards Järntorget when you’re suddenly thrown off the bike. The front weel got stuck in one of the tram tracks. You have a terrible pain in your arm and need to go the hospital. Your classmates will have to celebrate without you…\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                win: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"#root.dm\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"Congratulations! You won! Your strategy for reaching the bar awards you with a gold medal. Come back anytime if you want to play again.\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n                gameover: {\n                    initial: \"prompt\",\n                    on: {\n                        RECOGNISED: {\n                            target: \"#root.dm\",\n                        }\n                    },\n                    states: {\n                        prompt: {\n                            entry: say(\"Oh no! You lost! You didn't make it to the bar in time. Click on the screen if you want to try again.\"),\n                            on: { ENDSPEECH: \"ask\" }\n                        },\n                        ask: {\n                            entry: listen()\n                        }\n                    }\n                },\n            }\n        },\n        help: {\n            initial: \"prompt\",\n            states: {\n                prompt: {\n                    entry: say(\"Help message.\"),\n                    on: { ENDSPEECH: \"#root.dm\" }\n                }\n            }\n        },\n        quit: {\n            initial: \"prompt\",\n            states: {\n                prompt: {\n                    entry: say(\"Ok. You have quit the game.\"),\n                    on: { ENDSPEECH: \"#root.dm\" }\n                }\n            }\n        }\n    }\n})"]},"metadata":{},"sourceType":"module"}